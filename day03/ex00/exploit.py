import os
from bs4 import BeautifulSoup
import webbrowser


def page_title_modifying(soup: BeautifulSoup):
    new_title = "Evil Corp - Stealing your money every day"
    soup.title.string.replace_with(new_title)


def h1_tag_injection(soup: BeautifulSoup):
    name = soup.find("span", class_="name").text
    h1_tag = soup.new_tag('h1')
    # h1_tag.string = name + ", you are hacked!"
    h1_tag.string = f"{name}, you are hacked!"
    soup.find('body').insert(0, h1_tag)


def script_injection(soup: BeautifulSoup):
    with open("script.html", "r") as script_file:
        script_soup = BeautifulSoup(script_file, "lxml")
        soup.body.form.find(
          'input', type="submit", value="Send").insert_before(script_soup)


def link_modifying(soup: BeautifulSoup):
    new_link = "https://mrrobot.fandom.com/wiki/Fsociety"
    soup.find("a")['href'] = new_link
    soup.find("a").string.replace_with("Fsociety")


def page_edition(src, dest) -> None:
    with open(src, "r") as fp1:
        soup = BeautifulSoup(fp1, "lxml")

    page_title_modifying(soup)
    h1_tag_injection(soup)
    script_injection(soup)
    link_modifying(soup)

    with open(dest, "w") as fp2:
        fp2.write(str(soup.prettify()))


if __name__ == "__main__":
    src_file_path = "../../materials/evilcorp.html"
    dest_file_path = "../../materials/evilcorp_hacked.html"
    page_edition(src_file_path, dest_file_path)
    webbrowser.open('file://' + os.path.abspath(dest_file_path))
